{% extends 'base.html' %}
{% load static %}
{% load post_tags %}

{% block title %}Board{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/post_list.css' %}">
{% endblock %}

{% block content %}
<div class="board-wrapper with-sidebar">
  <div class="board-container">
    <!-- üîº ÏÉÅÎã® Ï†úÎ™© + Í≤ÄÏÉâ + Í∏ÄÏì∞Í∏∞ -->
    <div class="board-header">
      <h1 class="board-title">
        <a href="{% url 'post_list' %}" class="page-title-link" style="color: white; text-decoration: none;">Shared Playlists</a>
      </h1>
      <div class="board-actions">
        <form method="get" action="{% url 'post_list' %}" class="search-form">
          <input type="text" name="q" placeholder="Ï†úÎ™© Í≤ÄÏÉâ" value="{{ request.GET.q }}">
        </form>
        <a href="{% if user.is_authenticated %}{% url 'post_create' %}{% else %}#{% endif %}"
          class="btn-write{% if not user.is_authenticated %} not-logged-in-write{% endif %}">
          Í∏ÄÏì∞Í∏∞
        </a>
      </div>
    </div>

    <!-- üîΩ Í≤åÏãúÍ∏Ä Ïπ¥Îìú -->
    {% for post in posts %}
      <div class="post-card" data-post-id="{{ post.pk }}">
        <form method="post" action="{% if user.is_authenticated %}{% url 'scrap_post' post.pk %}{% else %}#{% endif %}" class="scrap-form">
          {% csrf_token %}
          <button type="submit" class="btn-scrap{% if not user.is_authenticated %} not-logged-in{% endif %}">
            <img src="{% static 'images/' %}{% if user.is_authenticated and post|scrapped:user %}scrap_on.png{% else %}scrap_off.png{% endif %}" alt="Ïä§ÌÅ¨Îû© ÏÉÅÌÉú" class="scrap-icon">
          </button>
        </form>

        <!-- ‚úÖ Ïç∏ÎÑ§Ïùº + Ï†ïÎ≥¥ Î¨∂Ïñ¥ÏÑú Ï†ïÎ†¨ -->
        <div class="post-contents">
          <div class="post-thumbnail">
            {% if post.thumbnail and post.thumbnail.name == "thumbnails/default.png" %}
              <img src="/media/thumbnails/default.png" alt="Í∏∞Î≥∏ Ïç∏ÎÑ§Ïùº" class="thumbnail">
            {% elif post.thumbnail %}
              <img src="{{ post.thumbnail.url }}" alt="Ïç∏ÎÑ§Ïùº" class="thumbnail">
            {% else %}
              <img src="/media/thumbnails/default.png" alt="Í∏∞Î≥∏ Ïç∏ÎÑ§Ïùº" class="thumbnail">
            {% endif %}
          </div>

          <a href="{% url 'post_detail' post.pk %}" class="post-card-link">
            <div class="post-info">
              <h2 class="post-title">{{ post.title }}</h2>
              <p class="post-description">{{ post.description }}</p>
              <p class="post-meta">{{ post.user.nickname }} ¬∑ {{ post.created_at|date:"YÎÖÑ nÏõî jÏùº g:i A" }}</p>
            </div>
          </a>
        </div>

        <!-- ‚úÖ ÏàòÏ†ï/ÏÇ≠Ï†ú -->
        <div class="post-actions">
          {% if user == post.user %}
            <a href="{% url 'post_edit' post.pk %}" class="edit-btn">ÏàòÏ†ï</a>
            <form method="post" action="{% url 'post_delete' post.pk %}" onsubmit="return confirm('Ï†ïÎßêÎ°ú ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="delete-btn">ÏÇ≠Ï†ú</button>
            </form>
          {% else %}
            <div style="height: 24px;"></div>
          {% endif %}
        </div>
      </div>

    {% endfor %}

    <form method="post" action="{% url 'toggle_lovelist' %}">
      {% csrf_token %}
      <input type="hidden" name="title" value="{{ song.title }}">
      <input type="hidden" name="artist" value="{{ song.artist }}">
      <input type="hidden" name="cover_url" value="{{ song.cover_url }}">
      <button type="submit" class="btn-like">
      <!-- {% if song in user_lovelist %}‚ù§Ô∏è{% else %}ü§ç{% endif %} -->
      </button>
    </form>


    <!-- ‚úÖ ÌéòÏù¥ÏßÄÎÑ§Ïù¥ÏÖò -->
    {% if posts.paginator.num_pages > 1 %}
      <div class="pagination">
        {% if posts.has_previous %}
          <a href="?page={{ posts.previous_page_number }}">Ïù¥Ï†Ñ</a>
        {% endif %}
        {% for num in posts.paginator.page_range %}
          {% if posts.number == num %}
            <strong>{{ num }}</strong>
          {% else %}
            <a href="?page={{ num }}">{{ num }}</a>
          {% endif %}
        {% endfor %}
        {% if posts.has_next %}
          <a href="?page={{ posts.next_page_number }}">Îã§Ïùå</a>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <!-- ‚úÖ ÏÇ¨Ïù¥ÎìúÎ∞î -->
  <div class="board-sidebar">
    <div class="sidebar-section">
      <h3>Ïä§ÌÅ¨Îû©</h3>
      <div class="scroll-box">
        <ul class="sidebar-list">
          {% for post in scrapped_posts %}
            <li><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="sidebar-section">
      <h3>ÏµúÍ∑º Î≥∏</h3>
      <div class="scroll-box">
        <ul class="sidebar-list">
          {% for post in recent_posts %}
            <li><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="sidebar-section">
      <h3>ÎÇ¥Í∞Ä Ïì¥ Í∏Ä</h3>
      <div class="scroll-box">
        <ul class="sidebar-list">
          {% for post in my_posts %}
            <li><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_script %}
  <script src="{% static 'js/base.js' %}"></script>
  <script src="{% static 'js/post_list.js' %}"></script>
{% endblock %}
