{% extends 'base.html' %}
{% load static %}
{% load post_tags %}

{% block title %}í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ê²Œì‹œíŒ{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/post_list.css' %}">
{% endblock %}

{% block content %}
<!-- ì¢Œìš° ì •ë ¬ì„ ìœ„í•œ ë‹¨ì¼ ë˜í¼ -->
<div class="board-wrapper with-sidebar">
  
  <!-- ğŸ“‹ ë©”ì¸ ê²Œì‹œíŒ ì˜ì—­ -->
  <div class="board-container">
    <!-- ğŸ”½ ìƒë‹¨ ì œëª© + ê¸€ì“°ê¸° ë²„íŠ¼ -->
    <div class="board-header">
      <h1 class="board-title">Shared Playlists</h1>

      {% if user.is_authenticated %}
        <a href="{% url 'post_create' %}" class="btn-write">ê¸€ì“°ê¸°</a>
      {% endif %}
    </div>

    <!-- ê²Œì‹œê¸€ ëª©ë¡ -->
    {% for post in posts %}
      <div class="post-card">
        <!-- âœ… ìŠ¤í¬ë© ë²„íŠ¼ (ìš°ì¸¡ ìƒë‹¨) -->
        {% if user.is_authenticated %}
          <form method="post" action="{% url 'scrap_post' post.pk %}" class="scrap-form">
            {% csrf_token %}
            <button type="submit" class="btn-scrap">
              <img 
                src="{% static 'images/' %}{% if post|scrapped:user %}scrap_on.png{% else %}scrap_off.png{% endif %}" 
                alt="ìŠ¤í¬ë© ìƒíƒœ" 
                class="scrap-icon">
            </button>
          </form>
        {% else %}
          <button class="btn-scrap" onclick="alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ í•­ëª©ì…ë‹ˆë‹¤.')">
            <img src="{% static 'images/scrap_off.png' %}" alt="ìŠ¤í¬ë© ì•„ì´ì½˜" class="scrap-icon">
          </button>
        {% endif %}

        <!-- âœ… ë§í¬ ì „ì²´ ì¹´ë“œ ê°ì‹¸ê¸° -->
        <a href="{% url 'post_detail' post.pk %}" class="post-card-link">
          {% if post.thumbnail.name == "thumbnails/default.png" %}
            <img src="/media/thumbnails/default.png" alt="ê¸°ë³¸ ì¸ë„¤ì¼" class="thumbnail">
          {% else %}
            <img src="{{ post.thumbnail.url }}" alt="ì¸ë„¤ì¼" class="thumbnail">
          {% endif %}

          <div class="post-info">
            <h2 class="post-title">{{ post.title }}</h2>
            <p class="post-description">{{ post.description }}</p>
            <p class="post-meta">
              {{ post.user.nickname }} Â· {{ post.created_at|date:"Yë…„ nì›” jì¼ g:i A" }}
            </p>
          </div>
        </a>
      </div>
    {% empty %}
      <p class="no-posts">ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endfor %}
  </div>

  <!-- âœ… ìš°ì¸¡ ì‚¬ì´ë“œë°” -->
  <div class="board-sidebar">
    <div class="sidebar-section">
      <h3>ğŸ“Œ ìŠ¤í¬ë©</h3>
      <ul class="sidebar-list">
        {% for post in scrapped_posts|slice:":3" %}
          <li><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></li>
        {% endfor %}
      </ul>
    </div>

    <div class="sidebar-section">
      <h3>ğŸ•’ ìµœê·¼ ë³¸</h3>
      <ul class="sidebar-list">
        {% for post in recent_posts|slice:":3" %}
          <li><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></li>
        {% endfor %}
      </ul>
    </div>

    <div class="sidebar-section">
      <h3>ğŸ“ ë‚´ê°€ ì“´ ê¸€</h3>
      <ul class="sidebar-list">
        {% for post in my_posts|slice:":3" %}
          <li><a href="{% url 'post_detail' post.pk %}">{{ post.title }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_script %}
  <script src="{% static 'js/base.js' %}"></script>
  <script src="{% static 'js/post_list.js' %}"></script>
{% endblock %}
