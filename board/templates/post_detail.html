{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }}{% endblock %}

{% block extra_head %}
  <link rel="stylesheet" href="{% static 'css/main.css' %}">
  <link rel="stylesheet" href="{% static 'css/post_detail.css' %}">
{% endblock %}

{% block content %}
<div class="post-detail-container">

  <!-- ìƒë‹¨: ë’¤ë¡œê°€ê¸° + ê¸€ì“°ê¸° ë²„íŠ¼ -->
  <div class="post-detail-actions">
    <a href="{% url 'post_list' %}" class="btn-back">â† ê²Œì‹œíŒìœ¼ë¡œ</a>
    {% if user.is_authenticated %}
      <a href="{% url 'post_create' %}" class="btn-write">ê¸€ì“°ê¸°</a>
    {% endif %}
  </div>

  <!-- ì œëª© + ì‘ì„±ì + ì¸ë„¤ì¼ -->
  <div class="post-header">
    <div class="title-area">
      <h1 class="post-title">{{ post.title }}</h1>
      <p class="post-meta">
        {{ post.user.nickname }} Â· {{ post.created_at|date:"Yë…„ nì›” jì¼ g:i A" }}
      </p>
    </div>

    {% if post.thumbnail %}
      <img src="{{ post.thumbnail.url }}" alt="ì¸ë„¤ì¼" class="post-thumbnail">
    {% endif %}
  </div>

  <!-- ë³¸ë¬¸ -->
  <div class="post-body">
    <pre class="post-description">{{ post.description }}</pre>
  </div>


  <!-- ì¢‹ì•„ìš” -->
  {% if user.is_authenticated %}
    <form method="post" action="{% url 'like_post' post.id %}">
      {% csrf_token %}
      <button type="submit" class="btn-like">
        {% if liked %}
          â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ
        {% else %}
          ğŸ¤ ì¢‹ì•„ìš”
        {% endif %}
        ({{ post.post_likes.count }})
      </button>
    </form>
  {% endif %}

  <!-- ëŒ“ê¸€ ì„¹ì…˜ -->
  <div class="comment-section">
    <h3>ëŒ“ê¸€</h3>

    {% for comment in post.comments.all %}
      {% if not comment.parent %}
        <div class="comment">
          <strong>{{ comment.user.nickname }}</strong>: {{ comment.text }}
          <button class="reply-btn" data-id="{{ comment.id }}">ë‹µê¸€</button>

          <!-- ëŒ€ëŒ“ê¸€ ëª©ë¡ -->
          {% for reply in comment.replies.all %}
            <div class="reply">
              â†³ <strong>{{ reply.user.nickname }}</strong>: {{ reply.text }}
            </div>
          {% endfor %}

          <!-- ëŒ€ëŒ“ê¸€ í¼ -->
          <form method="post" action="{% url 'comment_reply' comment.id %}" class="reply-form hidden" id="reply-form-{{ comment.id }}">
            {% csrf_token %}
            <input type="text" name="text" placeholder="ë‹µê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            <button type="submit">ì‘ì„±</button>
          </form>
        </div>
      {% endif %}
    {% endfor %}

    <!-- ëŒ“ê¸€ ì‘ì„± -->
    <form method="post" action="" id="commentForm">
      {% csrf_token %}
      {{ comment_form.text }}
      {{ comment_form.parent }}
      <button type="submit">ëŒ“ê¸€ ë‹¬ê¸°</button>
    </form>
  </div>

</div>
{% endblock %}

{% block extra_script %}
  <script src="{% static 'js/base.js' %}"></script>
  <script src="{% static 'js/post_detail.js' %}"></script>
{% endblock %}
