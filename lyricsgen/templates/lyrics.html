{% load static %}

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI 가사 생성기</title>
    <style>
        body {
            background-color: #000;  /* 배경을 어둡게 */
            }
        
        input, select, button {
            color: white;
            background-color: #222;
            border: 1px solid #555;
            padding: 5px;
            margin: 5px;
        }

        .modal {
          position: fixed;
          top: 10%;
          left: 50%;
          transform: translateX(-50%);
          width: 500px;
          max-height: 80vh;
          overflow-y: auto;
          padding: 20px;
          background: white;
          border: 1px solid #999;
          box-shadow: 0 0 20px rgba(0,0,0,0.3);
          z-index: 1000;
          opacity: 0;
          transition: opacity 0.3s ease;
        }
      
        .modal.show {
          opacity: 1;
        }
      
        #modalBackdrop {
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.4);
          z-index: 999;
          display: none;
        }
        .logo-box {
        position: fixed;
        top: 30px;
        left: 30px;
        z-index: 1000;
        display: flex;
        align-items: center;
        }

        .logo-box a {
        color: #fff;
        text-decoration: none;
        display: flex;
        align-items: center;
        }

        #logo-image {
        height: 40px;
        }

        #logo-text {
        font-size: 1.8rem;
        margin-left: 10px;
        color: white;
        }

        .nav-icon {
        position: fixed;
        top: 30px;
        right: 50px;
        z-index: 1000;
        cursor: pointer;
        }

        .nav-icon span {
        display: block;
        height: 4px;
        background: white;
        margin: 6px 0;
        width: 25px;
        }

        .side-menu {
        position: fixed;
        right: -50%;
        top: 0;
        width: 50%;
        height: 100%;
        background: #000;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: right 0.5s ease;
        z-index: 999;
        }

        .wrapper.nav-open .side-menu {
        right: 0;
        }

        .side-menu ul {
        list-style: none;
        text-align: right;
        }

        .side-menu li {
        font-size: 2rem;
        padding: 20px 0;
        cursor: pointer;
        }

        .side-menu li:hover {
        color: #60a5fa;
        }
      </style>
      
</head>
<body>
    <div class="wrapper">
        <!-- ✅ 로고 -->
        <div class="logo-box" id="logoBox">
          <a href="#">
            <img id="logo-image" src="{% static 'apple.png' %}">
            <span id="logo-text">MUSICTASTE</span>
          </a>
        </div>
    
        <!-- ✅ 햄버거 메뉴 아이콘 -->
        <div class="nav-icon" id="navIcon">
          <span></span>
          <span></span>
          <span></span>
        </div>
    
        <!-- ✅ 사이드 메뉴 -->
        <nav class="side-menu">
          <ul>
            <li data-target="section1">Home</li>
            <li data-target="section2">Works</li>
            <li data-target="section3">About</li>
            <li data-target="section4">Contact</li>
            <li data-target="section5">Hire us</li>
          </ul>
        </nav>

        <h1 style="margin-top: 100px; text-align: center; color: white;">AI 뮤즈</h1>

    <!-- 입력 폼 -->
    <form method="POST" action="{% url 'generate_lyrics' %}" style="margin-top: 100px;">
        {% csrf_token %}
        <input type="text" name="prompt" placeholder="노래 주제 입력" required style="width:300px; padding:5px;">

        <!-- 🎼 스타일 선택 -->
        <select name="style" required>
            <option value="ballad">발라드</option>
            <option value="hip-hop">힙합</option>
            <option value="rock">록</option>
            <option value="pop">팝</option>
            <option value="indie">인디</option> 
            <option value="jazz">재즈</option>
        </select>

        <select name="language" required>
            <option value="none">상관없음</option>
            <option value="korean">한국어</option>       <!-- Korean -->
            <option value="english">English</option>     <!-- English -->
            <option value="japanese">日本語</option>      <!-- Japanese -->
            <option value="chinese">中文</option>         <!-- Chinese -->
            <option value="thai">ไทย</option>            <!-- Thai -->
        </select>
        

        <button type="submit">가사 생성</button>
    </form>

    {% if lyrics %}
<hr>

<!-- 좌우 정렬 컨테이너 -->
<div style="display: flex; gap: 40px; align-items: flex-start;">

    <!-- 🎤 왼쪽: 가사 출력 -->
    <div style="flex: 1;">
        <h2 style="color: white;">🎤 "{{ title }}"</h2>
        <p style="color: white;"><strong>주제:</strong> {{ prompt }} / <strong>스타일:</strong> {{ style }} / <strong>언어:</strong> {{ language }}</p>
        <pre style="background:#f0f0f0; padding:10px;">{{ lyrics }}</pre>
    </div>


    <!-- 🎨 오른쪽: 앨범 이미지 + 다운로드 -->
    <div style="flex: 1; text-align: center;">
        <h3 style="color: white;">🎨 앨범 이미지</h3>
        <img src="{{ new_lyrics.image_file.url }}" width="256" style="border-radius: 8px;"><br>
        <a href="{{ new_lyrics.image_file.url }}" download style="color:rgb(110, 110, 223);" style="color: white;">📥 이미지 다운로드</a>
        <p style="color: white;">⏱ 생성 시간: {{ elapsed_time }}초</p>
    </div>

</div>
{% endif %}

{% if all_lyrics %}
    <hr>
    <h2>🗂 이전에 만든 가사들</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        {% for item in all_lyrics %}
            <div onclick="showLyricsModal(`{{ item.prompt }}`, `{{ item.lyrics|escapejs }}`)"
                 style="width: 200px; border: 1px solid #ccc; border-radius: 10px; padding: 10px; background: #fdfdfd;
                        box-shadow: 2px 2px 5px #ddd; cursor: pointer; text-align: center;">
    
                <!-- 앨범 썸네일 -->
                <img src="{{ item.image_file.url }}" alt="앨범 이미지" style="width: 100%; border-radius: 8px; margin-bottom: 8px;">
    
                <strong>{{ item.prompt }}</strong><br>
                <small>
                    {{ item.style }} /
                    {% if item.language == "korean" %}
                      🇰🇷 한국어
                    {% elif item.language == "english" %}
                      🇺🇸 영어
                    {% elif item.language == "japanese" %}
                      🇯🇵 일본어
                    {% elif item.language == "chinese" %}
                      🇨🇳 중국어
                    {% elif item.language == "thai" %}
                      🇹🇭 태국어
                    {% else %}
                      🌍 언어무관
                    {% endif %}
                  </small><br>
                  
                <small>{{ item.created_at|date:"Y-m-d H:i" }}</small>
            </div>
        {% endfor %}
    </div>
    
{% endif %}
<!-- 모달창 -->
<!-- 모달창 -->
<div id="lyricsModal" class="modal" style="display:none;">
    <h3 id="modalTitle">🎵 제목</h3>
    <pre id="modalLyrics" style="white-space: pre-wrap; background:#f9f9f9; padding:10px;"></pre>
    <button onclick="closeModal()">닫기</button>
</div>

<!-- 배경 어둡게 -->
<div id="modalBackdrop" style="display:none;" onclick="closeModal()"></div>


<!-- 자바스크립트 -->
<script>
    function showLyricsModal(title, lyrics) {
      const modal = document.getElementById("lyricsModal");
      const backdrop = document.getElementById("modalBackdrop");
  
      document.getElementById("modalTitle").innerText = `🎵 ${title}`;
      document.getElementById("modalLyrics").innerText = lyrics;
  
      backdrop.style.display = "block";
      modal.style.display = "block";
  
      // 애니메이션 클래스 부여 (fade in)
      setTimeout(() => {
        modal.classList.add("show");
      }, 10);
    }
  
    function closeModal() {
      const modal = document.getElementById("lyricsModal");
      const backdrop = document.getElementById("modalBackdrop");
  
      modal.classList.remove("show"); // fade-out 시작
      setTimeout(() => {
        modal.style.display = "none";
        backdrop.style.display = "none";
      }, 300); // 애니메이션 시간과 맞춰야 함 (0.3s)
    }
  
    // ⌨️ ESC 키로 닫기
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") {
        closeModal();
      }
    });


    const navIcon = document.getElementById('navIcon');
    const wrapper = document.querySelector('.wrapper');
    const menuLinks = document.querySelectorAll('.side-menu li');

    navIcon.addEventListener('click', () => {
        wrapper.classList.toggle('nav-open');
    });

    menuLinks.forEach(link => {
        link.addEventListener('click', () => {
        wrapper.classList.remove('nav-open');
        });
    });
</script>
  


</body>
</html>
