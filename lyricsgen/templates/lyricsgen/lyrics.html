<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>AI ê°€ì‚¬ ìƒì„±ê¸°</title>
    <style>
        .modal {
          position: fixed;
          top: 10%;
          left: 50%;
          transform: translateX(-50%);
          width: 500px;
          max-height: 80vh;
          overflow-y: auto;
          padding: 20px;
          background: white;
          border: 1px solid #999;
          box-shadow: 0 0 20px rgba(0,0,0,0.3);
          z-index: 1000;
          opacity: 0;
          transition: opacity 0.3s ease;
        }
      
        .modal.show {
          opacity: 1;
        }
      
        #modalBackdrop {
          position: fixed;
          top: 0; left: 0;
          width: 100%; height: 100%;
          background: rgba(0,0,0,0.4);
          z-index: 999;
          display: none;
        }
      </style>
      
</head>
<body>
    <h1>ğŸµ AI ê°€ì‚¬ ìƒì„±ê¸°</h1>

    <!-- ì…ë ¥ í¼ -->
    <form method="POST" action="{% url 'generate_lyrics' %}">
        {% csrf_token %}
        <input type="text" name="prompt" placeholder="ë…¸ë˜ ì£¼ì œ ì…ë ¥" required style="width:300px; padding:5px;">

        <!-- ğŸ¼ ìŠ¤íƒ€ì¼ ì„ íƒ -->
        <select name="style" required>
            <option value="ballad">ë°œë¼ë“œ</option>
            <option value="hip-hop">í™í•©</option>
            <option value="rock">ë¡</option>
            <option value="pop">íŒ</option>
            <option value="indie">ì¸ë””</option> 
            <option value="jazz">ì¬ì¦ˆ</option>
        </select>

        <select name="language" required>
            <option value="none">ìƒê´€ì—†ìŒ</option>
            <option value="korean">í•œêµ­ì–´ ìœ„ì£¼</option>
            <option value="english">ì˜ì–´ ìœ„ì£¼</option>
            <option value="japanese">ì¼ë³¸ì–´ ìœ„ì£¼</option>
            <option value="chinese">ì¤‘êµ­ì–´ ìœ„ì£¼</option>
            <option value="thai">íƒœêµ­ì–´ ìœ„ì£¼</option>
        </select>
        

        <button type="submit">ê°€ì‚¬ ìƒì„±</button>
    </form>

    {% if lyrics %}
<hr>

<!-- ì¢Œìš° ì •ë ¬ ì»¨í…Œì´ë„ˆ -->
<div style="display: flex; gap: 40px; align-items: flex-start;">

    <!-- ğŸ¤ ì™¼ìª½: ê°€ì‚¬ ì¶œë ¥ -->
    <div style="flex: 1;">
        <h2>ğŸ¤ "{{ title }}"</h2>
        <p><strong>ì£¼ì œ:</strong> {{ prompt }} / <strong>ìŠ¤íƒ€ì¼:</strong> {{ style }} / <strong>ì–¸ì–´:</strong> {{ language }}</p>
        <pre style="background:#f0f0f0; padding:10px;">{{ lyrics }}</pre>
    </div>


    <!-- ğŸ¨ ì˜¤ë¥¸ìª½: ì•¨ë²” ì´ë¯¸ì§€ + ë‹¤ìš´ë¡œë“œ -->
    <div style="flex: 1; text-align: center;">
        <h3>ğŸ¨ ì•¨ë²” ì´ë¯¸ì§€</h3>
        <img src="{{ new_lyrics.image_file.url }}" width="256" style="border-radius: 8px;"><br>
        <a href="{{ new_lyrics.image_file.url }}" download style="color:blue;">ğŸ“¥ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ</a>
        <p>â± ìƒì„± ì‹œê°„: {{ elapsed_time }}ì´ˆ</p>
    </div>

</div>
{% endif %}

{% if all_lyrics %}
    <hr>
    <h2>ğŸ—‚ ì´ì „ì— ë§Œë“  ê°€ì‚¬ë“¤</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
        {% for item in all_lyrics %}
            <div onclick="showLyricsModal(`{{ item.prompt }}`, `{{ item.lyrics|escapejs }}`)"
                 style="width: 200px; border: 1px solid #ccc; border-radius: 10px; padding: 10px; background: #fdfdfd;
                        box-shadow: 2px 2px 5px #ddd; cursor: pointer; text-align: center;">
    
                <!-- ì•¨ë²” ì¸ë„¤ì¼ -->
                <img src="{{ item.image_file.url }}" alt="ì•¨ë²” ì´ë¯¸ì§€" style="width: 100%; border-radius: 8px; margin-bottom: 8px;">
    
                <strong>{{ item.prompt }}</strong><br>
                <small>
                    {{ item.style }} /
                    {% if item.language == "korean" %}
                      ğŸ‡°ğŸ‡· í•œêµ­ì–´
                    {% elif item.language == "english" %}
                      ğŸ‡ºğŸ‡¸ ì˜ì–´
                    {% elif item.language == "japanese" %}
                      ğŸ‡¯ğŸ‡µ ì¼ë³¸ì–´
                    {% elif item.language == "chinese" %}
                      ğŸ‡¨ğŸ‡³ ì¤‘êµ­ì–´
                    {% elif item.language == "thai" %}
                      ğŸ‡¹ğŸ‡­ íƒœêµ­ì–´
                    {% else %}
                      ğŸŒ ì–¸ì–´ë¬´ê´€
                    {% endif %}
                  </small><br>
                  
                <small>{{ item.created_at|date:"Y-m-d H:i" }}</small>
            </div>
        {% endfor %}
    </div>
    
{% endif %}
<!-- ëª¨ë‹¬ì°½ -->
<!-- ëª¨ë‹¬ì°½ -->
<div id="lyricsModal" class="modal" style="display:none;">
    <h3 id="modalTitle">ğŸµ ì œëª©</h3>
    <pre id="modalLyrics" style="white-space: pre-wrap; background:#f9f9f9; padding:10px;"></pre>
    <button onclick="closeModal()">ë‹«ê¸°</button>
</div>

<!-- ë°°ê²½ ì–´ë‘¡ê²Œ -->
<div id="modalBackdrop" style="display:none;" onclick="closeModal()"></div>

<script>
    function showLyricsModal(title, lyrics) {
      const modal = document.getElementById("lyricsModal");
      const backdrop = document.getElementById("modalBackdrop");
  
      document.getElementById("modalTitle").innerText = `ğŸµ ${title}`;
      document.getElementById("modalLyrics").innerText = lyrics;
  
      backdrop.style.display = "block";
      modal.style.display = "block";
  
      // ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ë¶€ì—¬ (fade in)
      setTimeout(() => {
        modal.classList.add("show");
      }, 10);
    }
  
    function closeModal() {
      const modal = document.getElementById("lyricsModal");
      const backdrop = document.getElementById("modalBackdrop");
  
      modal.classList.remove("show"); // fade-out ì‹œì‘
      setTimeout(() => {
        modal.style.display = "none";
        backdrop.style.display = "none";
      }, 300); // ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ê³¼ ë§ì¶°ì•¼ í•¨ (0.3s)
    }
  
    // âŒ¨ï¸ ESC í‚¤ë¡œ ë‹«ê¸°
    document.addEventListener("keydown", function(e) {
      if (e.key === "Escape") {
        closeModal();
      }
    });
  </script>
  


</body>
</html>
